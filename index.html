<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>My Project</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Ubuntu">

        <!-- Script -->

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
        <script type="text/javascript" src="http://oauth.googlecode.com/svn/code/javascript/oauth.js"></script>
        <script type="text/javascript" src="http://oauth.googlecode.com/svn/code/javascript/sha1.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

        <style type="text/css">
            body{
                font-family: 'Ubuntu', serif;
                background: url("skulls.png") repeat 0 0;
            }

            .panel{
                text-align: center;
            }
            .text-snippet{
                text-align: left;
            }
        </style>
    </head>
        
        <body>

            <div class="col-lg-12">
                <h1 class="page-header">
                    My Project
                </h1>
                <input id="musicGenre">
                <input id="city">
                <button>Search</button>
                <button id="newSearch" onClick="window.location.reload()">New Search</button>
            </div>
            <br>

            <div id="content">
                
            </div>

            <script type="text/javascript">

        // key authentication begin

            var auth = {
                // Yelp keys and tokens
                consumerKey : "VP4buuF7sj7C57kDOH6sDA",
                consumerSecret : "5U95kCGUarDzJuXWu9jv_R2CUwY",
                accessToken : "eEiiUV5QjwGiCViFaC3u1cJHYgdvuK0d",
                accessTokenSecret : "xw9On4x8N8hePN_GhGJ7_ky98qw",
                serviceProvider : {
                    signatureMethod : "HMAC-SHA1"
                }
            };


            var accessor = {
                consumerSecret : auth.consumerSecret,
                tokenSecret : auth.accessTokenSecret
            };
            parameters = [];
            parameters.push(['callback', 'cb']);
            parameters.push(['oauth_consumer_key', auth.consumerKey]);
            parameters.push(['oauth_consumer_secret', auth.consumerSecret]);
            parameters.push(['oauth_token', auth.accessToken]);
            parameters.push(['oauth_signature_method', 'HMAC-SHA1']);

            // key authentication end

            $('#newSearch').hide();

            $("button").on("click", function(e) {
                e.preventDefault()

                var $myMusicInput = $("#musicGenre");
                var $myLocationInput = $("#city");
                var terms = $myMusicInput.val();
                var near = $myLocationInput.val();

                console.log(terms);
                console.log(near);

                parameters.push(['term', terms]);
                parameters.push(['location', near]);

                var message = {
                    'action' : 'http://api.yelp.com/v2/search',
                    'method' : 'GET',
                    'parameters' : parameters

                };

                OAuth.setTimestampAndNonce(message);
                OAuth.SignatureMethod.sign(message, accessor);

                var parameterMap = OAuth.getParameterMap(message.parameters);
                console.log(parameterMap);

                $.ajax({
                    'url' : message.action,
                    'data' : parameterMap,
                    'dataType' : 'jsonp',
                    'jsonpCallback' : 'cb',
                    'cache': true,
                    success : function( data, textStats, XMLHttpRequest ) {
                        console.log( data )
                        var sOptions = "";
                        aBusinesses = data.businesses

                        $.each( aBusinesses, function( index, value ) {
                            aBusinesses = value;

                            sOptions += "<div class='col-md-6'><div class='panel panel-success'><div class='panel-heading'><h4>" + aBusinesses.name + "</h4></div><div class='panel-body'><p>"+ "<div class='thumbnail'><img src="+aBusinesses.image_url+" class='img-rounded' style='width:150px;'></div>" + aBusinesses.location.address[0] + "<br><br> <p class='text-snippet'>" + aBusinesses.snippet_text + "</p> <br> <span class='glyphicon glyphicon-phone-alt' aria-hidden='true'></span>" + aBusinesses.display_phone + "<br><br>" + "<img src="+aBusinesses.rating_img_url_large + "></p><a href='" + aBusinesses.url + "' class='btn btn-default'>Find Out More..</a></div></div></div>"

                        });

                        $("#content").html(sOptions);

                        $('button').hide("");
                        $('#newSearch').show("slow");
                    }
                });
            });

            $("#newSearch").on("click", function(e) {
                e.preventDefault()

                $('button').show("");

            });

        </script>
        </body>
</html>